var data = {
    "0": [
        ['0', '', '0', '0', '0', '0', '', '石,false', '', '0'],
        ['0', '害,false', '0', '', '0', '0', '0', '', '0', ''],
        ['0', '', '0', '', '0', '0', '', '0', '0', '谊,false'],
        ['0', '', '', '心,false', '', '', '', '', '', ''],
        ['0', '', '0', '', '0', '0', '套,false', '0', '0', ''],
        ['0', '', '0', '', '0', '0', '', '0', '0', ''],
        ['0', '0', '0', '0', '0', '0', '', '0', '', '0'],
        ['', '0', '0', '0', '', '渡,false', '', '0', '', '0'],
        ['', '0', '0', '0', '0', '0', '', '0', '', '0'],
        ['躺,false', '', '0', '0', '0', '0', '0', '0', '狗,false', '']
    ],
    "1": [
        ['0', '', '0', '', '0', '0', '0', '', '', '感,false'],
        ['0', '智,false', '0', '吃,false', '', '', '', '0', '0', ''],
        ['0', '', '0', '0', '0', '0', '0', '0', '0', ''],
        ['0', '', '', '', '', '', '', '亿,false', '0', ''],
        ['0', '0', '0', '0', '0', '言,false', '0', '', '0', ''],
        ['', '', '任,false', '', '0', '', '0', '懵,false', '0', ''],
        ['', '0', '0', '0', '0', '', '0', '', '0', ''],
        ['大,false', '', '', '', '0', '', '0', '0', '0', '0'],
        ['', '0', '0', '0', '', '0', '0', '0', '0', '0'],
        ['', '0', '0', '0', '瘦,false', '', '', '', '', '']
    ],
    "2": [
        ['0', '0', '', '0', '', '塞,false', '', '0', '0', '0'],
        ['', '', '静,false', '', '0', '', '0', '', '0', '0'],
        ['0', '0', '', '0', '0', '0', '0', '', '0', '0'],
        ['0', '0', '', '0', '0', '', '0', '醉,false', '', '0'],
        ['我,false', '', '', '', '', '', '', '', '0', '0'],
        ['', '0', '', '0', '0', '', '0', '0', '0', '0'],
        ['', '0', '男,false', '0', '0', '天,false', '0', '0', '0', '0'],
        ['0', '0', '', '0', '0', '', '0', '活,false', '', ''],
        ['0', '0', '0', '0', '', '0', '0', '', '0', ''],
        ['', '', '看,false', '', '质,false', '0', '0', '', '0', '']
    ],
    "3": [
        ['北,false', '', '', '0', '0', '', '木,false', '', '0', '0'],
        ['', '0', '0', '0', '0', '0', '0', '', '0', '0'],
        ['', '0', '', '', '', '', '', '不,false', '', ''],
        ['0', '', '0', '0', '0', '0', '0', '', '0', '0'],
        ['', '要,false', '', '', '', '三,false', '', '0', '0', ''],
        ['0', '', '0', '0', '0', '0', '0', '0', '0', ''],
        ['0', '', '0', '0', '0', 'A,false', '', '', '', '蓝,false'],
        ['0', '', '0', '0', '0', '', '0', '0', '0', '0'],
        ['0', '0', '', '0', '0', '', '0', '0', '0', '吃,false'],
        ['0', '', '妹,false', '0', '0', '0', '', '', '', '']
    ]
}
var mydata = {
    "0": [
        ['0', '厉', '0', '0', '0', '0', '泥', '石,false', '流', '0'],
        ['0', '害,false', '0', '宝', '0', '0', '0', '化', '0', '友'],
        ['0', '了', '0', '宝', '0', '0', '总', '0', '0', '谊,false'],
        ['0', 'Word', '内', '心,false', '几', '乎', '是', '崩', '溃', '的'],
        ['0', '的', '0', '里', '0', '0', '套,false', '0', '0', '小'],
        ['0', '哥', '0', '苦', '0', '0', '路', '0', '0', '船'],
        ['0', '0', '0', '0', '0', '0', '得', '0', '阿', '0'],
        ['葛', '0', '0', '0', '摆', '渡,false', '人', '0', '尔', '0'],
        ['优', '0', '0', '0', '0', '0', '心', '0', '法', '0'],
        ['躺,false', '赢', '0', '0', '0', '0', '0', '0', '狗,false', '带']
    ],
    "1": [
        ['0', '鸡', '0', '套', '0', '0', '0', '第', '六', '感,false'],
        ['0', '智,false', '0', '吃,false', '瓜', '群', '众', '0', '0', '觉'],
        ['0', '如', '0', '0', '0', '0', '0', '0', '0', '身'],
        ['0', '我', '先', '挣', '他', '一', '个', '亿,false', '0', '体'],
        ['0', '0', '0', '0', '0', '言,false', '0', '脸', '0', '被'],
        ['有', '钱', '任,false', '性', '0', '不', '0', '懵,false', '0', '掏'],
        ['大', '0', '0', '0', '0', '合', '0', '逼', '0', '空'],
        ['大,false', '写', '的', '服', '0', '就', '0', '0', '0', '0'],
        ['的', '0', '0', '0', '蓝', '0', '0', '0', '0', '0'],
        ['梦', '0', '0', '0', '瘦,false', '成', '一', '道', '闪', '电']
    ],
    "2": [
        ['0', '0', '安', '0', '猴', '塞,false', '雷', '0', '0', '0'],
        ['我', '想', '静,false', '静', '0', '车', '0', '也', '0', '0'],
        ['0', '0', '地', '0', '0', '0', '0', '是', '0', '0'],
        ['0', '0', '做', '0', '0', '咋', '0', '醉,false', '拳', '0'],
        ['我,false', '整', '个', '人', '都', '不', '好', '了', '0', '0'],
        ['方', '0', '美', '0', '0', '上', '0', '0', '0', '0'],
        ['了', '0', '男,false', '0', '0', '天,false', '0', '0', '0', '0'],
        ['0', '0', '子', '0', '0', '呢', '0', '活,false', '到', '老'],
        ['0', '0', '0', '0', '潜', '0', '0', '久', '0', '司'],
        ['主', '要', '看,false', '气', '质,false', '0', '0', '见', '0', '机']
    ],
    "3": [
        ['北,false', '京', '瘫', '0', '0', '伐', '木,false', '累', '0', '0'],
        ['上', '0', '0', '0', '0', '0', '0', '觉', '0', '0'],
        ['广', '0', '画', '面', '太', '美', '我', '不,false', '敢', '看'],
        ['0', '偏', '0', '0', '0', '0', '0', '爱', '0', '0'],
        ['重', '要,false', '的', '话', '说', '三,false', '遍', '0', '0', '阅'],
        ['0', '靠', '0', '0', '0', '0', '0', '0', '0', '兵'],
        ['0', '才', '0', '0', '0', 'A,false', 'P', 'E', 'C', '蓝,false'],
        ['0', '华', '0', '0', '0', '4', '0', '0', '0', '0'],
        ['0', '0', '迷', '0', '0', '腰', '0', '0', '0', '吃,false'],
        ['0', '撩', '妹,false', '0', '0', '0', '洪', '荒', '之', '力']
    ]
}
var group = ['0,1', '0,2', '0,3', '1,0', '1,2', '1,3', '2,0', '2,1', '2,3', '3,0', '3,1', '3,2'];
var cache = [];
(function() {
    document.onreadystatechange = loading;

    function loading() {
        if (document.readyState == "complete") {
            $(".load").remove();
            $(".container").show();
            var mySwiper = new Swiper('.swiper-container', {
                speed: 1000,
                direction: 'vertical',
                loop: false,
                noSwiping: true,
                preloadImages: false,
            });
            //添加背景音乐
            music();
            // 开始游戏
            if (window.location.href.indexOf('?type') != -1) {
                setTimeout(function() {
                    $(".count_down_mak").show();
                    var num = -1;
                    var t = setInterval(function() {
                        num++;
                        if (num == 0) {
                            $('.count').html('<img src="images/bigchicken.png" />');
                        }
                        if (num == 1) {
                            $('.count').html('<img src="images/ready.png" class="imgt" />');
                        }
                        if (num == 2) {
                            $('.count').html('<img src="images/go.png" class="imgt" />');
                        }
                        if (num == 3) {
                            clearInterval(t);
                            $(".count_down_mak").hide();
                            cache = group[Math.floor(Math.random() * group.length)].split(',');
                            NumberGame.init(cache[NumberGame.count]); //初始化
                            // 时间计数
                            timer();
                        }
                    }, 600);
                }, 500);
            }
            //排行榜
            $("#ranking_btn").click(function() {
                window.location.href = 'WinningList.html';
            });
            //分享
            $('#share').click(function() {
                $('.wx-share').show();
            });
            //关闭分享弹框
            $('.wx-share').click(function() {
                $('.wx-share').hide();
            });
            //关闭from弹框
            $('.form_close').click(function() {
                $('.from_mak').hide();
            });
        }
    }
}());
var NumberGame = {
    CR: 0,
    _me: null,
    answer: null,
    count: 0,
    init: function(type) {
        var t = this;
        t.CR = data[cache[t.count]].length;
        t.update_page(type);
        $(".public-screen02-content").on('click', '.txt_box', function(e) {
            if ($(this).attr('data-i') == "true") {
                t._me = $(this);
                $('.txt_box').removeClass('active');
                $(this).addClass('active');
                t.start(t._me);
                $(this).attr('data-i') == 'true' ? ($(this).html($(this).attr('data-error') == 'true' ? '' : $(this).html())) : '';
            }
        });
        $(".key_box").on('click', '.key', function(e) {
            $(this).html() == 'Word' ? $('.active').addClass('word') : $('.active').removeClass('word');
            $('.active').eq(0).attr('data-switch', 'false');
            $('.txt_box').removeAttr('data-state');
            $('.active').html($(this).html()).attr('data-state', '1');
            t.count < 2 ? (t.answer == 1 ? t.start($('.txt_box[data-state="1"]')) : '', t.answer == 0 ? time() : '') : '';
        });
    },
    start: function(me) {
        var t = this;
        console.log(t.count)
        if (me.attr('data-i') != "false") {
            $(".txt_box").removeClass('active');
            me.addClass('active');
            if ($('.txt_box[data-state="1"]').length != '0' && $('.txt_box[data-state="1"]').attr('data-i') == 'true') {
                var tl = $('.txt_box[data-state="1"]').attr('data-coordinate').split('');
                var this_top = tl[0];
                var this_left = tl[1];
                var this_txt = $('.txt_box[data-state="1"]');
                if (mydata[cache[t.count]][this_top][this_left] == this_txt.html()) {
                    delete_key(this_txt.html());
                    this_txt.css({
                        'border-color': '#e44f25',
                        'background-color': '#FFF'
                    }).attr('data-i', 'false');
                    t.answer--;
                    console.log(t.answer)
                } else {
                    this_txt.css('background-color', '#ec8366').attr('data-error', 'true');
                }
            }
        }
    },
    update_page: function(GroupName) {
        $(".public-screen02-content").html('');
        $(".key_box").html('');
        for (var i = 0; i < this.CR; i++) {
            for (var j = 0; j < this.CR; j++) {
                if (data[GroupName][i][j] != '0') {
                    $(".public-screen02-content").append('<div data-i="true" data-switch="true" data-coordinate="' + i + j + '" class="txt_box ' + i + j + '">' + data[GroupName][i][j].split(',')[0] + '</div>');
                }
                if (data[GroupName][i][j].split(',')[1] == "false") {
                    $('.' + i + j).css({
                        background: '#fadcd3'
                    }).attr({
                        'data-i': 'false',
                        'data-switch': 'false'
                    });
                }
                $('.' + i + j).css({
                    top: i * 60,
                    left: j * 60
                });

            }
        }
        this.answer = $(".txt_box[data-i='true']").length;
        //备用字
        var spare_words = ['智', '障', '带', '我', '装', '逼', '带', '我', '飞', '开', '黑'];
        result(GroupName, spare_words);
    }
}


$(function() {
    //活动介绍
    $("#activity_btn").click(function() {
        $('.activity_mak').show();
    });
    // 关闭活动介绍
    $("#close").click(function() {
        $('.activity_mak').hide();
    });
});
//计数时间函数
function timer() {
    var HH = 0,
        mm = 0,
        ss = 0,
        str = '',
        when_long = 0,
        tim = '';
    tim = setInterval(function() {
        str = '';
        if (++ss == 60) {
            if (++mm == 60) {
                HH++;
                mm = 0;
            }
            ss = 0;
        }
        str += HH < 10 ? "0" + HH : HH;
        str += ":";
        str += mm < 10 ? "0" + mm : mm;
        str += ":";
        str += ss < 10 ? "0" + ss : ss;
        $(".grade>span").html(str);
        if (NumberGame.count == 2) {
            clearInterval(tim);
            when_long = HH * 3600 + mm * 60 + ss + ',' + str;
            window.location.href = 'GameResult.html?when_long=' + when_long;
        }
    }, 1000);
}
//答案处理函数
function result(GroupName, spare_words) {
    var arr = [],
        arradd = [];
    for (var i = 0; i < NumberGame.CR; i++) {
        for (var j = 0; j < NumberGame.CR; j++) {
            //可选文字
            if (mydata[GroupName][i][j] != '0' && mydata[GroupName][i][j].split(',').length != 2) {
                arr.push(mydata[GroupName][i][j]);
            }
        }
    }
    if (arr.length < 40) {
        for (var s = 0; s < 40 - arr.length; s++) {
            arradd.push(spare_words[s])
        }
    }
    arr = arr.concat(arradd).shuffle();
    for (var d = 0; d < arr.length; d++) {

        if (arr[d] == 'Word') {
            $(".key_box").append('<span class="key word">' + arr[d] + '</span>');
        } else {
            $(".key_box").append('<span class="key">' + arr[d] + '</span>');
        }
    }
}
Array.prototype.shuffle = function() {
        let m = this.length,
            i;
        while (m) {
            i = (Math.random() * m--) >>> 0;
            [this[m], this[i]] = [this[i], this[m]]
        }
        return this;
    }
    //背景音乐
function music() {
    var a = document.createElement('AUDIO');
    a.setAttribute('src', 'images/music.mp3');
    a.setAttribute('loop', true);
    a.setAttribute('autoplay', true);
    a.setAttribute('id', 'myaudio');
    document.body.appendChild(a);
    var my_music = document.getElementById('myaudio');
    $('#music').click(function() {
        if ($(this).hasClass('mysic_active')) {
            $(this).removeClass('mysic_active');
            my_music.pause();
            $("#music").css('background', 'url(images/music.png)');
        } else {
            $(this).addClass('mysic_active');
            my_music.play();
            $("#music").css('background', 'url(images/music2.png)');
        };
    });
}
//预加载
function time() {
    console.log(NumberGame.count)
    if (NumberGame.count == 0) {
        setTimeout(function() {
            $(".count_head img").attr('src', 'images/shut2.png')
            $('.count').html('');
            $(".count_down_mak").show();
            var num = -1;
            var t = setInterval(function() {
                num++;
                if (num == 0) {
                    $('.count').html('<img src="images/bigchicken.png" />');
                }
                if (num == 1) {
                    $('.count').html('<img src="images/ready.png" class="imgt" />');
                }
                if (num == 2) {
                    $('.count').html('<img src="images/go.png" class="imgt" />');
                }
                if (num == 3) {
                    clearInterval(t);
                    $(".count_down_mak").hide();
                    NumberGame.update_page(cache[++NumberGame.count]);
                    addborder();
                }
            }, 600);
        }, 500);
    }
    NumberGame.count == 1 ? ++NumberGame.count : '';
}

function addborder() {
    var txt_box_switch = $('.txt_box[data-switch="true"]');
    $('.txt_box').removeClass('active');
    txt_box_switch.eq(0).addClass('active');
    NumberGame._me = $('.active');
    NumberGame.start(NumberGame._me);
    $('.active').attr('data-i') == 'true' ? ($(this).html($(this).attr('data-error') == 'true' ? '' : $(this).html())) : '';
}
//删除按键
function delete_key(keyhtml) {
    for (var i = 0; i < $('.key').length; i++) {
        if ($('.key').eq(i).html() == keyhtml) {
            $('.key').eq(i).remove();
            return false;
        }
    }
}