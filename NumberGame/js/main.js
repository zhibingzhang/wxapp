var data = {
    "0": [
        ['0', '厉,false', '0', '0', '0', '0', '', '石,false', '', '0'],
        ['0', '', '0', '宝,false', '0', '0', '0', '', '0', ''],
        ['0', '', '0', '', '0', '0', '总,false', '0', '0', '谊,false'],
        ['0', 'Word,false', '', '心,false', '', '', '', '崩,false', '', ''],
        ['0', '', '0', '', '0', '0', '', '0', '0', '小,false'],
        ['0', '0', '0', '', '0', '0', '路,false', '0', '0', ''],
        ['0', '0', '0', '0', '0', '0', '', '0', '', '0'],
        ['葛,false', '0', '0', '0', '摆,false', '', '人,false', '0', '尔,false', '0'],
        ['', '0', '0', '0', '0', '0', '', '0', '', '0'],
        ['', '', '0', '0', '0', '0', '0', '0', '狗,false', '']
    ],
    "1": [
        ['0', '机,false', '0', '套,false', '0', '0', '0', '第,false', '', ''],
        ['0', '', '0', '', '', '群,false', '', '0', '0', '觉,false'],
        ['0', '如,false', '0', '0', '0', '0', '0', '0', '0', ''],
        ['0', '', '先,false', '', '他,false', '', '', '亿,false', '0', ''],
        ['0', '0', '0', '0', '0', '言,false', '0', '0', '0', '被,false'],
        ['有,false', '', '任,false', '', '0', '', '0', '0', '0', ''],
        ['', '0', '0', '0', '0', '', '0', '0', '0', '空,false'],
        ['大,false', '', '', '服,false', '0', '就,false', '0', '0', '0', '0'],
        ['', '0', '0', '0', '', '0', '0', '0', '0', '0'],
        ['梦,false', '0', '0', '0', '瘦,false', '', '', '道,false', '', '']
    ],
    "2": [
        ['0', '0', '', '0', '', '塞,false', '', '0', '0', '0'],
        ['我,false', '', '静,false', '', '0', '0', '0', '', '0', '0'],
        ['0', '0', '', '0', '0', '0', '0', '是,false', '0', '0'],
        ['0', '0', '做,false', '0', '0', '', '0', '', '0', '0'],
        ['我,false', '', '', '', '', '不,false', '', '了,false', '0', '0'],
        ['', '0', '', '0', '0', '', '0', '0', '0', '0'],
        ['了,false', '0', '男,false', '0', '0', '天,false', '0', '0', '0', '0'],
        ['0', '0', '', '0', '0', '', '0', '', '到,false', ''],
        ['0', '0', '0', '0', '', '0', '0', '久,false', '0', '司,false'],
        ['', '', '看,false', '', '质,false', '0', '0', '', '0', '']
    ],
    "3": [
        ['', '京,false', '', '0', '0', '伐,false', '', '', '0', '0'],
        ['', '0', '0', '0', '0', '0', '0', '', '0', '0'],
        ['广,false', '0', '画,false', '', '太,false', '', '', '不,false', '', ''],
        ['0', '', '0', '0', '0', '0', '0', '', '0', '0'],
        ['', '要,false', '', '话,false', '', '三,false', '', '0', '0', '阅,false'],
        ['0', '', '0', '0', '0', '0', '0', '0', '0', ''],
        ['0', '', '0', '0', '0', '', 'P,false', '', '', '蓝,false'],
        ['0', '华,false', '0', '0', '0', '4,false', '0', '0', '0', '0'],
        ['0', '0', '', '0', '0', '', '0', '0', '0', '0'],
        ['0', '撩,false', '', '0', '0', '0', '', '荒,false', '', '']
    ]
}
var mydata = {
        "0": [
            ['0', '厉,false', '0', '0', '0', '0', '泥,2', '石,false', '流,2', '0'],
            ['0', '害,1', '0', '宝,false', '0', '0', '0', '化,3', '0', '友,5'],
            ['0', '了,1', '0', '宝,4', '0', '0', '总,false', '0', '0', '谊,false'],
            ['0', 'Word,false', '内,6', '心,false', '几,6', '乎,6', '是,6', '崩,false', '溃,6', '的,5'],
            ['0', '哥,1', '0', '里,4', '0', '0', '套,7', '0', '0', '小,false'],
            ['0', '0', '0', '苦,4', '0', '0', '路,false', '0', '0', '船,5'],
            ['0', '0', '0', '0', '0', '0', '得,7', '0', '阿,11', '0'],
            ['葛,false', '0', '0', '0', '摆,false', '渡,7', '人,false', '0', '尔,false', '0'],
            ['优,8', '0', '0', '0', '0', '0', '心,7', '0', '法,11', '0'],
            ['躺,8', '枪,9', '0', '0', '0', '0', '0', '0', '狗,false', '带,12']
        ],
        "1": [
            ['0', '机,false', '0', '套,false', '0', '0', '0', '第,false', '六,3', '感,3'],
            ['0', '智,1', '0', '吃,2', '瓜,4', '群,false', '众,4', '0', '0', '觉,false'],
            ['0', '如,false', '0', '0', '0', '0', '0', '0', '0', '身,5'],
            ['0', '我,1', '先,false', '挣,6', '他,false', '一,6', '个,6', '亿,false', '0', '体,5'],
            ['0', '0', '0', '0', '0', '言,false', '0', '0', '0', '被,false'],
            ['有,false', '钱,9', '任,false', '性,9', '0', '不,8', '0', '0', '0', '掏,5'],
            ['大,10', '0', '0', '0', '0', '合,8', '0', '0', '0', '空,false'],
            ['大,false', '写,11', '的,11', '服,false', '0', '就,false', '0', '0', '0', '0'],
            ['的,10', '0', '0', '0', '蓝,12', '0', '0', '0', '0', '0'],
            ['梦,false', '0', '0', '0', '瘦,false', '成,13', '一,13', '道,false', '闪,13', '电,13']
        ],
        "2": [
            ['0', '0', '安,1', '0', '猴,3', '塞,false', '雷,3', '0', '0', '0'],
            ['我,false', '想,2', '静,false', '静,2', '0', '0', '0', '也,5', '0', '0'],
            ['0', '0', '地,1', '0', '0', '0', '0', '是,false', '0', '0'],
            ['0', '0', '做,false', '0', '0', '咋,7', '0', '醉,5', '0', '0'],
            ['我,false', '整,8', '个,1', '人,8', '都,8', '不,false', '好,8', '了,false', '0', '0'],
            ['方,9', '0', '美,1', '0', '0', '上,7', '0', '0', '0', '0'],
            ['了,false', '0', '男,false', '0', '0', '天,false', '0', '0', '0', '0'],
            ['0', '0', '子,1', '0', '0', '呢,7', '0', '活,10', '到,false', '老,10'],
            ['0', '0', '0', '0', '潜,11', '0', '0', '久,false', '0', '司,false'],
            ['主,14', '要,14', '看,false', '气,14', '质,false', '0', '0', '见,12', '0', '机,13']
        ],
        "3": [
            ['北,1', '京,false', '瘫,1', '0', '0', '伐,false', '木,2', '累,2', '0', '0'],
            ['上,3', '0', '0', '0', '0', '0', '0', '觉,5', '0', '0'],
            ['广,false', '0', '画,false', '面,4', '太,false', '美,4', '我,4', '不,false', '敢,4', '看,4'],
            ['0', '偏,6', '0', '0', '0', '0', '0', '爱,5', '0', '0'],
            ['重,7', '要,false', '的,7', '话,false', '说,7', '三,false', '遍,7', '0', '0', '阅,false'],
            ['0', '靠,6', '0', '0', '0', '0', '0', '0', '0', '兵,8'],
            ['0', '才,6', '0', '0', '0', 'A,9', 'P,false', 'E,9', 'C,9', '蓝,false'],
            ['0', '华,false', '0', '0', '0', '4,false', '0', '0', '0', '0'],
            ['0', '0', '迷,11', '0', '0', '腰,10', '0', '0', '0', '0'],
            ['0', '撩,false', '妹,12', '0', '0', '0', '洪,13', '荒,false', '之,13', '力,13']
        ]
    }
    // var group = ['0,1', '0,2', '0,3', '1,0', '1,2', '1,3', '2,0', '2,1', '2,3', '3,0', '3,1', '3,2'];
var group = ['0', '1', '2', '3'];
var cache = [];
(function() {
    document.onreadystatechange = loading;

    function loading() {
        if (document.readyState == "complete") {
            $(".load").remove();
            $(".container").show();
            var mySwiper = new Swiper('.swiper-container', {
                speed: 1000,
                direction: 'vertical',
                loop: false,
                noSwiping: true,
                preloadImages: false,
            });
            // 开始游戏
            if (window.location.href.indexOf('?type') != -1) {
                setTimeout(function() {
                    $(".count_down_mak").show();
                    var num = 0;
                    var t = setInterval(function() {
                        num++;
                        if (num == 1) {
                            $('.count_down_box').html('<div class="count_head"><img src="images/shut11.png" /></div><div class="count"><img src="images/ready.png" class="imgt" /></div>');
                        }
                        if (num == 2) {
                            $('.count_down_box').html('<div class="count_head"><img src="images/shut11.png" /></div><div class="count"><img src="images/go.png" class="imgt" /></div>');
                        }
                        if (num == 3) {
                            clearInterval(t);
                            $(".count_down_mak").hide();
                            cache = group[Math.floor(Math.random() * group.length)].split(',');
                            NumberGame.init(cache[NumberGame.count]); //初始化
                            // 时间计数
                            timer();
                        }
                    }, 1600);
                }, 500);
            }
            //分享
            $('#share').click(function() {
                $('.wx-share').show();
            });
            //关闭分享弹框
            $('.wx-share').click(function() {
                $('.wx-share').hide();
            });
            //关闭from弹框
            $('.form_close').click(function() {
                $('.from_mak').hide();
            });
        }
    }
}());
var group_txt
var NumberGame = {
    CR: 0,
    _me: null,
    answer: null,
    count: 0,
    init: function(type) {
        var t = this;
        t.CR = data[cache[t.count]].length;
        t.update_page(type);
        addborder(false);
        $(".public-screen02-content").on('click', '.txt_box', function(e) {
            if ($(this).attr('data-i') == "true") {
                t._me = $(this);
                $('.txt_box').removeClass('active');
                $(this).addClass('active');
                t.start(t._me);
                $(this).attr('data-i') == 'true' ? ($(this).html($(this).attr('data-error') == 'true' ? '' : $(this).html())) : '';
            }
        });
        $(".key_box").on('click', '.key', function(e) {
            $(this).html() == 'Word' ? $('.active').addClass('word') : $('.active').removeClass('word');
            $('.active').attr('data-group') != undefined ? group_txt = $('.active').attr('data-group') : '';
            // $('.key').removeClass('key_active');
            // $(this).addClass('key_active');
            $('.active').eq(0).attr('data-switch', 'false').removeAttr('data-group');
            $('.txt_box').removeAttr('data-state');
            $('.active').html($(this).html()).attr('data-state', '1');
            addborder(true, group_txt);
            console.log(t.answer)
            t.count < 2 ? (t.answer == 1 ? t.start($('.txt_box[data-state="1"]')) : '', t.answer == 0 ? NumberGame.count++ : '') : '';
        });
    },
    start: function(me) {
        var t = this;
        if (me.attr('data-i') != "false") {
            $(".txt_box").removeClass('active');
            me.addClass('active');
            if ($('.txt_box[data-state="1"]').length != '0' && $('.txt_box[data-state="1"]').attr('data-i') == 'true') {
                var tl = $('.txt_box[data-state="1"]').attr('data-coordinate').split('');
                var this_top = tl[0];
                var this_left = tl[1];
                var this_txt = $('.txt_box[data-state="1"]');
                if (mydata[cache[t.count]][this_top][this_left].split(',')[0] == this_txt.html()) {
                    delete_key(this_txt.html());
                    this_txt.css({
                        'border-color': '#e44f25',
                        'background-color': '#FFF'
                    }).attr('data-i', 'false');
                    t.answer--;
                } else {
                    this_txt.css('background-color', '#ec8366').attr('data-error', 'true');
                }
            }
        }
    },
    update_page: function(GroupName) {
        $(".public-screen02-content").html('');
        $(".key_box").html('');
        for (var i = 0; i < this.CR; i++) {
            for (var j = 0; j < this.CR; j++) {
                if (data[GroupName][i][j] != '0') {
                    if (data[GroupName][i][j].split(',')[0] == 'Word') {
                        $(".public-screen02-content").append('<div data-i="true" data-switch="true" data-coordinate="' + i + j + '" class="txt_box word ' + i + j + '">' + data[GroupName][i][j].split(',')[0] + '</div>');
                    } else {
                        $(".public-screen02-content").append('<div data-i="true" data-switch="true" data-coordinate="' + i + j + '" class="txt_box ' + i + j + '">' + data[GroupName][i][j].split(',')[0] + '</div>');
                    }
                }

                if (data[GroupName][i][j].split(',')[1] == "false") {
                    $('.' + i + j).css({
                        background: '#ffdf57'
                    }).attr({
                        'data-i': 'false',
                        'data-switch': 'false'
                    });
                }
                if (mydata[GroupName][i][j].split(',')[1] != 'false' && mydata[GroupName][i][j].split(',')[1] != undefined) {
                    $('.' + i + j).attr('data-group', mydata[GroupName][i][j].split(',')[1]);
                }
                $('.' + i + j).css({
                    top: i * 60,
                    left: j * 60
                });

            }
        }
        this.answer = $(".txt_box[data-i='true']").length;
        //备用字
        var spare_words = ['智', '障', '带', '我', '装', '逼', '带', '我', '飞', '开', '黑', '酷', '污', '残'];
        result(GroupName, spare_words);
    }
}


$(function() {
    //活动介绍
    $("#activity_btn").click(function() {
        $('.activity_mak').show();
    });
    // 关闭活动介绍
    $("#close").click(function() {
        $('.activity_mak').hide();
    });
});
//计数时间函数
function timer() {
    // var HH = 0,
    //     mm = 0,
    //     ss = 0,
    //     str = '',
    //     when_long = 0,
    //     tim = '';
    // tim = setInterval(function() {
    //     str = '';
    //     if (++ss == 60) {
    //         if (++mm == 60) {
    //             HH++;
    //             mm = 0;
    //         }
    //         ss = 0;
    //     }
    //     // str += HH < 10 ? "0" + HH : HH;
    //     // str += ":";
    //     str += mm < 10 ? "0" + mm : mm;
    //     str += ":";
    //     str += ss < 10 ? "0" + ss : ss;



    //     if (NumberGame.count == 1) {
    //         clearInterval(tim);
    //         var when_long = mm * 60 + ss + ',' + str;
    //         window.location.href = 'GameResult.html?when_long=' + when_long;
    //     }
    //     if ((mm * 60 + ss) >= 180) {
    //         window.location.href = 'GameResult.html?when_long=false,' + str;
    //     }
    // }, 1000);



    var sum = 180,
        mm = 0,
        ss = 0,
        str = '';
    var t = setInterval(function() {
        mm = parseInt(sum / 60) < 10 ? '0' + parseInt(sum / 60) : parseInt(sum / 60);
        ss = mm < 0 ? '0' + sum : (sum % 60 < 10 ? '0' + sum % 60 : sum % 60);
        str = mm + ":" + ss;
        $(".grade>span").html(str);


        if (NumberGame.count == 1) {
            var when_long =compile(parseInt(sum / 60) * 60 + sum % 60 + ',' + str);
            console.log(when_long)
            window.location.href = 'GameResult.html?when_long=' + when_long;
        }
        if (sum == 0) {
            clearInterval(t);
            var type = compile('false,'+str);
            window.location.href = 'GameResult.html?when_long=' + type;
        }
        sum--;
    }, 1000);

}
//答案处理函数
function result(GroupName, spare_words) {
    var arr = [],
        arradd = [];
    for (var i = 0; i < NumberGame.CR; i++) {
        for (var j = 0; j < NumberGame.CR; j++) {
            //可选文字
            if (mydata[GroupName][i][j] != '0' && mydata[GroupName][i][j].split(',')[1] != 'false') {
                arr.push(mydata[GroupName][i][j].split(',')[0]);
            }
        }
    }
    if (arr.length < 40) {
        for (var s = 0; s < 40 - arr.length; s++) {
            arradd.push(spare_words[s])
        }
    }
    arr = arr.concat(arradd).shuffle();
    console.log(arr)
    for (var d = 0; d < arr.length; d++) {
        $(".key_box").append('<span class="key">' + arr[d] + '</span>');
    }
}
Array.prototype.shuffle = function() {
        let m = this.length,
            i;
        while (m) {
            i = (Math.random() * m--) >>> 0;
            [this[m], this[i]] = [this[i], this[m]]
        }
        return this;
    }
    //预加载
    // function time() {
    //     if (NumberGame.count == 0) {
    //         setTimeout(function() {
    //             $('.count_down_box').html('<div class="count_head"><img src="images/shut2.png" /></div><div class="count"><p><img src="images/off.png"></p><img src="images/bigchicken.gif" /></div>');
    //             $(".count_down_mak").show();
    //             var num = 0;
    //             var t = setInterval(function() {
    //                 num++;
    //                 if (num == 1) {
    //                     $('.count_down_box').html('<div class="count_head"><img src="images/shut2.png" /></div><div class="count"><img src="images/ready.png" class="imgt" /></div>');
    //                 }
    //                 if (num == 2) {
    //                     $('.count_down_box').html('<div class="count_head"><img src="images/shut2.png" /></div><div class="count"><img src="images/go.png" class="imgt" /></div>');
    //                 }
    //                 if (num == 3) {
    //                     clearInterval(t);
    //                     $(".count_down_mak").hide();
    //                     NumberGame.update_page(cache[++NumberGame.count]);
    //                     addborder();
    //                 }
    //             }, 1200);
    //         }, 500);
    //     }
    //     NumberGame.count == 1 ? ++NumberGame.count : '';
    // }
var num = 0;

function addborder(bool, group_txt) {
    var txt_box_switch = $('.txt_box[data-switch="true"]');
    var group_list = $('.txt_box[data-group="' + group_txt + '"]');
    $('.txt_box').removeClass('active');
    var len = $('.txt_box[data-group="' + group_txt + '"]').length;
    if (bool) {
        group_list.length <= 0 ? txt_box_switch.eq(0).addClass('active') : group_list.eq(0).addClass('active');

    } else {
        txt_box_switch.eq(0).addClass('active');
    }
    NumberGame._me = $('.active');
    NumberGame.start(NumberGame._me);
    $('.active').attr('data-i') == 'true' ? ($(this).html($(this).attr('data-error') == 'true' ? '' : $(this).html())) : '';
}
//删除按键
function delete_key(keyhtml) {
    for (var i = 0; i < $('.key').length; i++) {
        if ($('.key').eq(i).html() == keyhtml) {
            $('.key').eq(i).remove();
            return false;
        }
    }
}

//url加密函数
function compile(code)  
{    
   var str=String.fromCharCode(code.charCodeAt(0)+code.length);  
   for(var i=1;i<code.length;i++){  
   str+=String.fromCharCode(code.charCodeAt(i)+code.charCodeAt(i-1));  
   }  
   return escape(str);
}  

//url 解密
function uncompile(code)  
{  
   code=unescape(code);  
   var str=String.fromCharCode(code.charCodeAt(0)-code.length);  
   for(var i=1;i<code.length;i++){  
   str+=String.fromCharCode(code.charCodeAt(i)-str.charCodeAt(i-1));  
   }  
   return str;  
}  